### ============================================
### Carrier API Simulator - Error Testing
### ============================================
### Test all error codes and edge cases
### Use with VS Code REST Client extension
###
### Start server: npm run start:dev
### Server runs on: http://localhost:3001/api/v1
### ============================================

@baseUrl = http://localhost:3001/api/v1
@apiKey = test_clarence_key_123

### ============================================
### 1. AUTHENTICATION ERRORS (401)
### ============================================

### Missing API Key - Should return 401
POST {{baseUrl}}/carriers/reliable_insurance/quote
Content-Type: application/json

{
  "quote_request_id": "test_001",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### Invalid API Key - Should return 401
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: wrong_api_key_123
Content-Type: application/json

{
  "quote_request_id": "test_002",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### ============================================
### 2. VALIDATION ERRORS (400)
### ============================================

### Invalid Insurance Type - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_003",
  "insurance_type": "invalid_type",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### Missing Required Field - insurance_type - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_004"
}

### Missing Required Field - business_info - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_005",
  "insurance_type": "commercial",
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### Missing Required Field - coverage_requests - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_006",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": []
}

### Missing Required Field - address in business_info - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_007",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### Missing Required Field - requested_deductible - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_008",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "effective_date": "2025-12-01"
    }
  ]
}

### Invalid Data Type - annual_revenue as string - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_009",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": "500000",
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### ============================================
### 3. NOT FOUND ERRORS (404)
### ============================================

### Invalid Carrier ID - Should return 404 CARRIER_NOT_FOUND
POST {{baseUrl}}/carriers/invalid_carrier_id/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_010",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
}

### Invalid Quote ID - Should return 404 NOT_FOUND
POST {{baseUrl}}/carriers/reliable_insurance/bind
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_id": "INVALID-QUOTE-ID-999999",
  "effective_date": "2025-12-01",
  "payment_plan": "annual",
  "payment_info": {
    "method": "credit_card",
    "token": "tok_test_123",
    "billing_address": {
      "street": "123 Main St",
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    }
  },
  "insured_info": {
    "primary_contact": {
      "first_name": "John",
      "last_name": "Doe",
      "email": "john@test.com",
      "phone": "+15551234567"
    }
  },
  "signature": {
    "full_name": "John Doe",
    "signed_at": "2025-11-11T10:00:00Z",
    "ip_address": "192.168.1.1"
  }
}

### Invalid Policy ID - Should return 404 POLICY_NOT_FOUND
GET {{baseUrl}}/carriers/reliable_insurance/policies/INVALID-POLICY-ID-999999
X-API-Key: {{apiKey}}

### Invalid Policy ID - Renew - Should return 404 POLICY_NOT_FOUND
POST {{baseUrl}}/carriers/reliable_insurance/policies/INVALID-POLICY-ID/renew
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "renewal_type": "standard",
  "desired_effective_date": "2026-12-01"
}

### Invalid Policy ID - Endorse - Should return 404 POLICY_NOT_FOUND
POST {{baseUrl}}/carriers/reliable_insurance/policies/INVALID-POLICY-ID/endorse
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "endorsement_type": "increase_limits",
  "effective_date": "2025-12-15",
  "details": {
    "new_limits": {
      "per_occurrence": 2000000
    }
  }
}

### Invalid Policy ID - Cancel - Should return 404 POLICY_NOT_FOUND
POST {{baseUrl}}/carriers/reliable_insurance/policies/INVALID-POLICY-ID/cancel
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "cancellation_type": "insured_request",
  "effective_date": "2026-03-01",
  "reason": "Testing error handling",
  "signature": {
    "full_name": "John Doe",
    "signed_at": "2025-11-11T10:00:00Z",
    "ip_address": "192.168.1.1"
  }
}

### Invalid Policy ID - Certificate - Should return 404 POLICY_NOT_FOUND
POST {{baseUrl}}/carriers/reliable_insurance/policies/INVALID-POLICY-ID/certificate
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "certificate_holder": {
    "name": "Test Company LLC",
    "address": {
      "street": "123 Test St",
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    }
  },
  "additional_insured": true,
  "description_of_operations": "Testing error handling"
}

### ============================================
### 4. BIND VALIDATION ERRORS (400)
### ============================================

### Missing Required Field - quote_id - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/bind
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "effective_date": "2025-12-01",
  "payment_plan": "annual",
  "payment_info": {
    "method": "credit_card",
    "token": "tok_test",
    "billing_address": {
      "street": "123 Main St",
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    }
  },
  "insured_info": {
    "primary_contact": {
      "first_name": "John",
      "last_name": "Doe",
      "email": "john@test.com",
      "phone": "+15551234567"
    }
  },
  "signature": {
    "full_name": "John Doe",
    "signed_at": "2025-11-11T10:00:00Z",
    "ip_address": "192.168.1.1"
  }
}

### Missing Required Field - payment_info.billing_address - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/bind
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_id": "test-quote-id",
  "effective_date": "2025-12-01",
  "payment_plan": "annual",
  "payment_info": {
    "method": "credit_card",
    "token": "tok_test"
  },
  "insured_info": {
    "primary_contact": {
      "first_name": "John",
      "last_name": "Doe",
      "email": "john@test.com",
      "phone": "+15551234567"
    }
  },
  "signature": {
    "full_name": "John Doe",
    "signed_at": "2025-11-11T10:00:00Z",
    "ip_address": "192.168.1.1"
  }
}

### Invalid Payment Plan - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/bind
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_id": "test-quote-id",
  "effective_date": "2025-12-01",
  "payment_plan": "invalid_plan",
  "payment_info": {
    "method": "credit_card",
    "token": "tok_test",
    "billing_address": {
      "street": "123 Main St",
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    }
  },
  "insured_info": {
    "primary_contact": {
      "first_name": "John",
      "last_name": "Doe",
      "email": "john@test.com",
      "phone": "+15551234567"
    }
  },
  "signature": {
    "full_name": "John Doe",
    "signed_at": "2025-11-11T10:00:00Z",
    "ip_address": "192.168.1.1"
  }
}

### ============================================
### 5. MALFORMED JSON (400)
### ============================================

### Invalid JSON Syntax - Should return 400
POST {{baseUrl}}/carriers/reliable_insurance/quote
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "quote_request_id": "test_011",
  "insurance_type": "commercial",
  "business_info": {
    "legal_name": "Test Company",
    "industry": "Technology",
    "industry_code": "541512",
    "address": {
      "city": "San Francisco",
      "state": "CA",
      "zip": "94102"
    },
    "financial_info": {
      "annual_revenue": 500000,
      "full_time_employees": 5
    }
  },
  "coverage_requests": [
    {
      "coverage_type": "general_liability",
      "requested_limits": {
        "per_occurrence": 1000000
      },
      "requested_deductible": 500,
      "effective_date": "2025-12-01"
    }
  ]
  // Missing closing brace
